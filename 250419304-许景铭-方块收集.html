<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>方块收集游戏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .game-container {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
        }
        
        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .score {
            color: #333;
        }
        
        .high-score {
            color: #666;
        }
        
        canvas {
            border: 2px solid #333;
            border-radius: 5px;
            width: 100%;
            height: auto;
            background-color: #e0e0e0;
        }
        
        .controls {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }
        
        .block-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .block-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .block-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        .block-blue {
            background-color: #2196F3;
        }
        
        .block-red {
            background-color: #F44336;
        }
        
        .block-yellow {
            background-color: #FFC107;
        }
    </style>
</head>
<body>
    <h1>方块收集游戏</h1>
    
    <div class="game-container">
        <div class="score-board">
            <div class="score">当前分数: <span id="current-score">0</span></div>
            <div class="high-score">最高分: <span id="high-score">0</span></div>
        </div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="block-info">
            <div class="block-item">
                <div class="block-color block-blue"></div>
                <span>蓝色方块: 10分</span>
            </div>
            <div class="block-item">
                <div class="block-color block-red"></div>
                <span>红色方块: 20分</span>
            </div>
            <div class="block-item">
                <div class="block-color block-yellow"></div>
                <span>黄色方块: 50分</span>
            </div>
        </div>
        
        <div class="controls">
            <button id="startBtn">开始游戏</button>
            <button id="pauseBtn" disabled>暂停游戏</button>
            <button id="resetBtn">重新开始</button>
        </div>
    </div>
    
    <div class="instructions">
        使用键盘左右方向键控制角色移动，接住掉落的方块得分！
    </div>

    <script>
        // 游戏配置
        const config = {
            canvasWidth: 800,
            canvasHeight: 600,
            playerWidth: 80,
            playerHeight: 20,
            playerSpeed: 8,
            blockWidth: 40,
            blockHeight: 40,
            blockSpeed: 3,
            spawnInterval: 1000, // 方块生成间隔（毫秒）
            colors: [
                { color: '#2196F3', points: 10, name: '蓝色方块' }, // 蓝色方块，10分
                { color: '#F44336', points: 20, name: '红色方块' }, // 红色方块，20分
                { color: '#FFC107', points: 50, name: '黄色方块' }  // 黄色方块，50分
            ]
        };

        // 游戏状态
        let gameState = {
            isPlaying: false,
            currentScore: 0,
            highScore: 0,
            player: {
                x: config.canvasWidth / 2 - config.playerWidth / 2,
                y: config.canvasHeight - config.playerHeight - 10
            },
            blocks: [],
            lastSpawnTime: 0,
            keys: {
                left: false,
                right: false
            }
        };

        // 获取DOM元素
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const currentScoreEl = document.getElementById('current-score');
        const highScoreEl = document.getElementById('high-score');

        // 初始化最高分
        gameState.highScore = localStorage.getItem('blockGameHighScore') || 0;
        highScoreEl.textContent = gameState.highScore;

        // 事件监听
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', pauseGame);
        resetBtn.addEventListener('click', resetGame);
        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);

        // 开始游戏
        function startGame() {
            gameState.isPlaying = true;
            gameState.lastSpawnTime = Date.now();
            
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            resetBtn.disabled = false;
            
            // 开始游戏循环
            requestAnimationFrame(gameLoop);
        }

        // 暂停游戏
        function pauseGame() {
            gameState.isPlaying = !gameState.isPlaying;
            
            if (gameState.isPlaying) {
                pauseBtn.textContent = "暂停游戏";
                requestAnimationFrame(gameLoop);
            } else {
                pauseBtn.textContent = "继续游戏";
            }
            
            startBtn.disabled = true;
            resetBtn.disabled = false;
        }

        // 重置游戏
        function resetGame() {
            gameState.isPlaying = false;
            gameState.currentScore = 0;
            gameState.blocks = [];
            gameState.player.x = config.canvasWidth / 2 - config.playerWidth / 2;
            currentScoreEl.textContent = gameState.currentScore;
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            pauseBtn.textContent = "暂停游戏";
            
            // 清除画布
            ctx.clearRect(0, 0, config.canvasWidth, config.canvasHeight);
        }

        // 键盘按下事件
        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft') {
                gameState.keys.left = true;
            } else if (e.key === 'ArrowRight') {
                gameState.keys.right = true;
            }
        }

        // 键盘松开事件
        function handleKeyUp(e) {
            if (e.key === 'ArrowLeft') {
                gameState.keys.left = false;
            } else if (e.key === 'ArrowRight') {
                gameState.keys.right = false;
            }
        }

        // 游戏循环
        function gameLoop(timestamp) {
            if (!gameState.isPlaying) return;

            // 清除画布
            ctx.clearRect(0, 0, config.canvasWidth, config.canvasHeight);

            // 更新玩家位置
            updatePlayer();

            // 生成新方块
            spawnBlocks();

            // 更新方块位置
            updateBlocks();

            // 碰撞检测
            checkCollisions();

            // 绘制游戏元素
            drawPlayer();
            drawBlocks();

            // 继续游戏循环
            requestAnimationFrame(gameLoop);
        }

        // 更新玩家位置
        function updatePlayer() {
            if (gameState.keys.left && gameState.player.x > 0) {
                gameState.player.x -= config.playerSpeed;
            }
            if (gameState.keys.right && gameState.player.x < config.canvasWidth - config.playerWidth) {
                gameState.player.x += config.playerSpeed;
            }
        }

        // 生成新方块
        function spawnBlocks() {
            const now = Date.now();
            if (now - gameState.lastSpawnTime > config.spawnInterval) {
                const colorIndex = Math.floor(Math.random() * config.colors.length);
                const block = {
                    x: Math.random() * (config.canvasWidth - config.blockWidth),
                    y: -config.blockHeight,
                    color: config.colors[colorIndex].color,
                    points: config.colors[colorIndex].points,
                    name: config.colors[colorIndex].name
                };
                gameState.blocks.push(block);
                gameState.lastSpawnTime = now;
                
                // 随着分数增加，提高方块生成速度
                if (gameState.currentScore > 100) {
                    config.spawnInterval = Math.max(500, 1000 - Math.floor(gameState.currentScore / 50) * 10);
                }
            }
        }

        // 更新方块位置
        function updateBlocks() {
            for (let i = gameState.blocks.length - 1; i >= 0; i--) {
                const block = gameState.blocks[i];
                block.y += config.blockSpeed;
                
                // 移除超出屏幕的方块
                if (block.y > config.canvasHeight) {
                    gameState.blocks.splice(i, 1);
                }
            }
        }

        // 碰撞检测
        function checkCollisions() {
            for (let i = gameState.blocks.length - 1; i >= 0; i--) {
                const block = gameState.blocks[i];
                
                // 检查方块是否与玩家碰撞
                if (
                    block.x < gameState.player.x + config.playerWidth &&
                    block.x + config.blockWidth > gameState.player.x &&
                    block.y + config.blockHeight > gameState.player.y &&
                    block.y < gameState.player.y + config.playerHeight
                ) {
                    // 加分
                    gameState.currentScore += block.points;
                    currentScoreEl.textContent = gameState.currentScore;
                    
                    // 更新最高分
                    if (gameState.currentScore > gameState.highScore) {
                        gameState.highScore = gameState.currentScore;
                        highScoreEl.textContent = gameState.highScore;
                        localStorage.setItem('blockGameHighScore', gameState.highScore);
                    }
                    
                    // 移除被接住的方块
                    gameState.blocks.splice(i, 1);
                    
                    // 短暂显示得分
                    showScorePopup(block.x + config.blockWidth/2, block.y, `+${block.points}`);
                }
            }
        }

        // 显示得分弹窗
        function showScorePopup(x, y, text) {
            ctx.save();
            ctx.font = 'bold 20px Arial';
            ctx.fillStyle = '#333';
            ctx.textAlign = 'center';
            ctx.fillText(text, x, y);
            ctx.restore();
            
            // 短暂显示后消失（通过游戏循环自然消失）
            setTimeout(() => {
                // 不需要额外操作，因为下一帧会清除画布
            }, 500);
        }

        // 绘制玩家
        function drawPlayer() {
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(gameState.player.x, gameState.player.y, config.playerWidth, config.playerHeight);
            
            // 添加平台边框
            ctx.strokeStyle = '#2E7D32';
            ctx.lineWidth = 2;
            ctx.strokeRect(gameState.player.x, gameState.player.y, config.playerWidth, config.playerHeight);
        }

        // 绘制方块
        function drawBlocks() {
            gameState.blocks.forEach(block => {
                ctx.fillStyle = block.color;
                ctx.fillRect(block.x, block.y, config.blockWidth, config.blockHeight);
                
                // 添加方块边框
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.strokeRect(block.x, block.y, config.blockWidth, config.blockHeight);
                
                // 绘制方块上的分数
                ctx.fillStyle = '#FFF';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(
                    block.points, 
                    block.x + config.blockWidth/2, 
                    block.y + config.blockHeight/2 + 5
                );
            });
        }
    </script>
</body>
</html>